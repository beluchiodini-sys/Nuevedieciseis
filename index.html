<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>NUEVEDIECISEIS</title>
  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f6f8;
    }
    h2 {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    canvas {
      margin-top: 10px;
      background: white;
    }
    textarea {
      width: 100%;
      height: 400px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-wrap;
    }
    button, input {
      padding: 10px;
      margin-top: 10px;
      display: block;
      cursor: pointer;
    }
    .qr-container {
      margin: 20px 0;
    }
    .alerta {
      font-weight: bold;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .verde { background-color: lightgreen; }
    .amarillo { background-color: yellow; }
    .rojo { background-color: tomato; }
  </style>
</head>
<body>

<h2>
  NUEVEDIECISEIS
  <span id="reloj">‚è±</span>
</h2>

<div class="qr-container">
  <canvas id="qr" width="200" height="200"></canvas>
  <button onclick="descargarQR()">üì• Descargar QR</button>
</div>

<textarea id="plantilla"></textarea>

<button onclick="descargarTexto()">üìÑ Descargar Planilla T√©cnica</button>

<h3>Control de Horas</h3>
<label for="horaMaquina">Horas del equipo:</label>
<input type="number" id="horaMaquina" placeholder="Ej: 10894">

<label for="horaActual">Horas actuales:</label>
<input type="number" id="horaActual" placeholder="Ej: 3">

<button onclick="verificarHoras()">‚úÖ Verificar Horas</button>
<div id="alerta"></div>

<script>
  const plantilla = document.getElementById("plantilla");

  // Restaurar contenido si existe
  if (localStorage.getItem("plantilla")) {
    plantilla.value = localStorage.getItem("plantilla");
  } else {
    plantilla.value = `PLANILLA T√âCNICA\nEscriba aqu√≠...`;
  }

  plantilla.addEventListener("input", () => {
    localStorage.setItem("plantilla", plantilla.value);
  });

  const canvas = document.getElementById("qr");
  const qr = new QRious({
    element: canvas,
    value: location.href,
    size: 200,
    background: 'white',
    foreground: 'black'
  });

  function descargarQR() {
    const enlace = document.createElement("a");
    enlace.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
    enlace.download = "QR_NUEVEDIECISEIS.png";
    enlace.click();
  }

  function descargarTexto() {
    const contenido = plantilla.value;
    const blob = new Blob([contenido], { type: "text/plain" });
    const enlace = document.createElement("a");
    enlace.href = URL.createObjectURL(blob);
    enlace.download = "planilla_tecnica.txt";
    enlace.click();
  }

  setInterval(() => {
    document.getElementById("reloj").textContent = "‚è± " + new Date().toLocaleTimeString();
  }, 1000);

  function verificarHoras() {
    const horaMaquina = parseFloat(document.getElementById("horaMaquina").value);
    const horaActual = parseFloat(document.getElementById("horaActual").value);
    const total = horaMaquina + horaActual;
    const alerta = document.getElementById("alerta");

    alerta.innerHTML = "";
    alerta.className = "alerta";

    if (total >= 250 && total < 300) {
      alerta.innerText = "‚ö†Ô∏è MOTOR (250h)";
      alerta.classList.add("verde");
    } else if (total >= 1000 && total < 1050) {
      alerta.innerText = "‚ö†Ô∏è TRANSMISI√ìN (1000h)";
      alerta.classList.add("amarillo");
    } else if (total >= 2000 && total < 2050) {
      alerta.innerText = "‚ö†Ô∏è HIDR√ÅULICO (2000h)";
      alerta.classList.add("rojo");
    } else {
      alerta.className = "";
    }
  }
</script>

</body>
</html>
